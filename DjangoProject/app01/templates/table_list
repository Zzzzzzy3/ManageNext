-- 账户信息表
CREATE TABLE account (
    account_id      INT AUTO_INCREMENT PRIMARY KEY COMMENT '账户唯一标识',
    username        VARCHAR(255) UNIQUE NOT NULL COMMENT '登录账号（唯一）',
    password_hash   VARCHAR(255) NOT NULL COMMENT '加密后的密码（BCrypt/SHA-256）',
    mobile          VARCHAR(20) COMMENT '绑定手机号',
    role_name       VARCHAR(50) NOT NULL DEFAULT '普通用户' COMMENT '角色名称（如管理员/采购员）',
    permissions     JSON COMMENT '权限集合（JSON数组）',
    status          ENUM('正常', '冻结', '未激活', '已注销') NOT NULL DEFAULT '正常' COMMENT '账户状态',
    login_history   JSON COMMENT '登录日志（JSON数组）',
    created_time    DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time    DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='账户信息表';

-- 菜品信息表
CREATE TABLE dish (
    dish_id         INT AUTO_INCREMENT PRIMARY KEY COMMENT '菜品唯一标识',
    dish_name       VARCHAR(255) UNIQUE NOT NULL COMMENT '菜品名称（唯一约束）',
    dish_amount     INT NOT NULL DEFAULT 0 CHECK (dish_amount >= 0) COMMENT '库存数量（非负整数）',
    dish_price      DECIMAL(10,2) NOT NULL CHECK (dish_price >= 0) COMMENT '菜品价格（非负小数）',
    created_time    DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time    DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='菜品信息表';

-- 库存表
CREATE TABLE inventory (
    inventory_id    INT AUTO_INCREMENT PRIMARY KEY COMMENT '库存记录唯一标识',
    product_name    VARCHAR(255) NOT NULL COMMENT '商品名称',
    spec            VARCHAR(255) COMMENT '规格描述',
    supplier_id     INT COMMENT '供应商ID',
    current_quantity INT COMMENT '实时库存量',
    warehouse_loc   VARCHAR(255) COMMENT '仓库位置',
    batch_no        VARCHAR(50) COMMENT '批次号',
    unit_price      DECIMAL(10, 2) COMMENT '当前商品单价',
    category        ENUM('生鲜', '冻品', '调料') COMMENT '分类标签',
    FOREIGN KEY (supplier_id) REFERENCES supplier(supplier_id) ON DELETE SET NULL COMMENT '关联供应商表'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='库存信息表';

-- 供应商表
CREATE TABLE supplier (
    supplier_id     INT AUTO_INCREMENT PRIMARY KEY COMMENT '供应商唯一标识（自增主键）',
    name            VARCHAR(255) UNIQUE NOT NULL COMMENT '供应商名称（唯一约束）',
    contact_person  VARCHAR(255) COMMENT '主要联系人姓名',
    phone           VARCHAR(255) COMMENT '联系电话',
    email           VARCHAR(255) COMMENT '联系邮箱',
    address         VARCHAR(255) COMMENT '详细地址',
    status          ENUM('启用', '停用', '待审核') COMMENT '合作状态',
    contracts       JSON COMMENT '合同信息（JSON数组）',
    contacts        JSON COMMENT '联系人列表（JSON数组）',
    created_time    DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_time    DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后修改时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='供应商信息表';

-- 采购订单表
CREATE TABLE purchase_order (
    order_id        VARCHAR(50) PRIMARY KEY COMMENT '采购订单唯一标识',
    supplier_id     INT NOT NULL COMMENT '供应商ID',
    order_time      DATETIME NOT NULL COMMENT '下单时间',
    total_amount    DECIMAL(18, 2) COMMENT '订单总金额',
    status          ENUM('待审核', '已提交', '已发货', '已完成', '已取消') COMMENT '订单状态',
    payment_status  ENUM('未支付', '部分支付', '已付全款') COMMENT '支付状态',
    items           JSON COMMENT '商品明细（JSON数组）',
    delivery_address VARCHAR(255) COMMENT '收货地址',
    operator        VARCHAR(50) COMMENT '操作人',
    notes           TEXT COMMENT '备注',
    created_time    DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '订单创建时间',
    updated_time    DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后更新时间',
    FOREIGN KEY (supplier_id) REFERENCES supplier(supplier_id) ON DELETE CASCADE COMMENT '关联供应商表'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='采购订单表';

-- 订单明细表（新增关联表）
CREATE TABLE purchase_order_item (
    item_id         INT AUTO_INCREMENT PRIMARY KEY COMMENT '订单明细ID',
    order_id        VARCHAR(50) NOT NULL COMMENT '所属订单ID',
    dish_id         INT COMMENT '关联菜品ID',
    quantity        INT NOT NULL COMMENT '采购数量',
    unit_price      DECIMAL(10,2) NOT NULL COMMENT '单价',
    FOREIGN KEY (order_id) REFERENCES purchase_order(order_id) ON DELETE CASCADE COMMENT '关联采购订单表',
    FOREIGN KEY (dish_id) REFERENCES dish(dish_id) ON DELETE SET NULL COMMENT '关联菜品表'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='采购订单明细表';
